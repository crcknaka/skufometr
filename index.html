<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–°–∫—É—Ñ–æ–º–µ—Ä 3000 ‚Äî –Ω–∞—Å–∫–æ–ª—å–∫–æ —Ç—ã —Å–∫—É—Ñ?</title>
<meta name="description" content="–®—É—Ç–æ—á–Ω—ã–π —Ç–µ—Å—Ç-–∞–Ω–∫–µ—Ç–∞: —É–∑–Ω–∞–π –ø—Ä–æ—Ü–µ–Ω—Ç —Å–≤–æ–µ–π —Å–∫—É—Ñ–Ω–æ—Å—Ç–∏ ‚Äî —Å–æ —Å–º–µ—à–Ω—ã–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏, –≤–µ—Ç–≤–ª–µ–Ω–∏—è–º–∏ –∏ –∂–∏–≤—ã–º —Å–∫—É—Ñ-–º–µ—Ç—Ä–æ–º." />
<style>
  :root{
    --bg: #0b0f15;
    --card: #101622;
    --muted: #7f8ba3;
    --primary: #8ab4ff;
    --accent: #c792ea;
    --good: #4ad295;
    --warn: #ffd166;
    --bad: #ff6b6b;
    --text: #e8eefc;
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius: 18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif; color:var(--text);
    background:
      radial-gradient(60vw 60vw at -10% -10%, #172033 0%, transparent 60%),
      radial-gradient(60vw 60vw at 110% 110%, #1a1430 0%, transparent 60%),
      var(--bg);
    letter-spacing:.2px;
  }
  .container{max-width: 980px; margin: 24px auto; padding: 24px;}
  .header{display:flex; align-items:center; gap:16px; flex-wrap:wrap; justify-content:space-between; margin-bottom: 18px;}
  .brand{display:flex; align-items:center; gap:14px}
  .logo{width:56px; height:56px; border-radius:15px;background:conic-gradient(from 210deg, var(--primary), var(--accent), var(--bad), var(--good), var(--primary));filter:saturate(1.2); position:relative; box-shadow: var(--shadow);}
  .logo::after{content:"ü§ì"; position:absolute; inset:0; display:grid; place-items:center; font-size:28px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35));}
  .title{font-weight:800; font-size: clamp(22px, 3vw, 30px)}
  .subtitle{color:var(--muted); font-size:14px}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.04)) , var(--card);
    border: 1px solid rgba(255,255,255,.05);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 18px;
  }
  .toolbar{display:flex; gap:10px; flex-wrap:wrap}
  button, .ghost{
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.08));
    border: 1px solid rgba(255,255,255,.08);
    color: var(--text);
    padding: 10px 14px; border-radius: 12px; cursor:pointer;
    font-weight:700; transition: transform .06s ease, background .2s ease, border-color .2s ease;
  }
  button:hover{transform: translateY(-1px)}
  button.primary{background: linear-gradient(180deg, rgba(138,180,255,.25), rgba(138,180,255,.08)); border-color: rgba(138,180,255,.35)}
  button.warn{background: linear-gradient(180deg, rgba(255,209,102,.25), rgba(255,209,102,.08)); border-color: rgba(255,209,102,.35)}
  button.danger{background: linear-gradient(180deg, rgba(255,107,107,.25), rgba(255,107,107,.08)); border-color: rgba(255,107,107,.35)}
  button.ghost{background: transparent}
  .meter{padding:16px; border-radius: 16px; background: rgba(255,255,255,.02); border: 1px solid rgba(255,255,255,.06); display:grid; gap:10px;}
  .bar{height: 16px; background: rgba(255,255,255,.06); border-radius: 999px; overflow:hidden; position:relative;}
  .bar>span{display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--good), var(--warn), var(--bad)); border-radius:999px; transition: width .35s cubic-bezier(.2,.8,.2,1);}
  .percent{font-weight:800; font-size: 34px}
  .quip{color:var(--muted); font-size:14px}
  .question{display:grid; gap:14px; margin-top:8px}
  .qtext{font-size:20px; font-weight:800; line-height:1.2}
  .options{display:grid; gap:10px}
  .opt{display:flex; align-items:center; gap:10px; padding:12px; background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; cursor:pointer; transition: background .2s ease, border-color .2s ease, transform .06s ease;}
  .opt:hover{background: rgba(255,255,255,.06); transform: translateY(-1px)}
  .opt input{accent-color: var(--primary); transform: scale(1.1)}
  .opt span{font-weight:600}
  .nav{display:flex; gap:8px; justify-content:space-between; margin-top:10px}
  .progressline{height: 3px; background: rgba(255,255,255,.08); border-radius: 4px; overflow:hidden; margin:12px 0 0;}
  .progressline>span{display:block; height:3px; width:0%; background: linear-gradient(90deg, var(--primary), var(--accent)); transition: width .25s ease}
  .muted{color:var(--muted); font-size:13px}
  .result{display:grid; gap:10px; text-align:center; padding: 14px 6px 2px;}
  .badge{display:inline-grid; place-items:center; font-size: 46px; border-radius: 18px; padding: 8px 12px; width:min(100%, 420px); margin: 0 auto; background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06)); border:1px solid rgba(255,255,255,.08);}
  .share{display:flex; gap:8px; flex-wrap:wrap; justify-content:center}
  .footnote{color:var(--muted); text-align:center; font-size:12px; margin-top:10px}
  .hidden{display:none}
  .mode{font-size:12px; color:var(--muted)}
  .toast{
    position:fixed; bottom:16px; left:50%; transform:translateX(-50%);
    background:#111826; color:var(--text); border:1px solid rgba(255,255,255,.1);
    padding:10px 14px; border-radius:12px; box-shadow:var(--shadow);
    opacity:0; pointer-events:none;
    transition: opacity .3s ease, transform .3s ease;
    max-width: 94%; text-align:center; z-index:9999;
  }
  .toast.show{opacity:1; transform:translateX(-50%) translateY(-4px)}
  @media (max-width:560px){ .percent{font-size:28px} .badge{font-size: 40px} }
  @media print{
    body{background:#fff; color:#111;}
    .container{max-width:800px; margin:0 auto; padding:40px;}
    .header, #meterCard, #questionCard, .toolbar, #toast{display:none !important;}
    .card{background:#fff; border:none; box-shadow:none; color:#111;}
    .result{display:grid !important; gap:16px; text-align:center; padding:48px; border:3px solid #8ab4ff; border-radius:30px;}
    .result .badge{background:none; border:none; color:inherit;}
    .result .share, .result button{display:none !important;}
    .footnote{margin-top:24px; color:#555;}
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="title">–°–∫—É—Ñ–æ–º–µ—Ä 3000</div>
          <div class="subtitle">–®—É—Ç–æ—á–Ω—ã–π —Ç–µ—Å—Ç —Å –≤–µ—Ç–≤–ª–µ–Ω–∏—è–º–∏. –û—Ç–≤–µ—Ç—å —á–µ—Å—Ç–Ω–æ ‚Äî —Å—Ç—ã–¥–∏—Ç—å—Å—è –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥–µ–º üòå</div>
        </div>
      </div>
      <div class="toolbar">
        <button class="ghost" id="toggleMode" title="–†–µ–∂–∏–º: –æ–±—ã—á–Ω—ã–π">üßì –û–±—ã—á–Ω—ã–π</button>
        <button class="ghost" id="restartBtn">üîÅ –°–±—Ä–æ—Å–∏—Ç—å</button>
        <button class="primary" id="startBtn">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å</button>
      </div>
    </div>

    <div class="card meter" id="meterCard" aria-live="polite">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <div class="percent"><span id="percentVal">0</span>% —Å–∫—É—Ñ</div>
        <div class="muted mode" id="modeHint">–†–µ–∂–∏–º: –û–±—ã—á–Ω—ã–π</div>
      </div>
      <div class="bar" aria-label="–°–∫—É—Ñ-–º–µ—Ç—Ä"><span id="meterBar"></span></div>
      <div class="quip" id="quip">–ü–æ–∫–∞ —á—Ç–æ —Ç—ã –∫–∞–∫ —Å–≤–µ–∂–∏–π –æ–≥—É—Ä—á–∏–∫. –ù–æ –º—ã —É–∂–µ –∑–∞–Ω–µ—Å–ª–∏ –≤–∞–ª–∏–¥–æ–ª‚Ä¶</div>
    </div>

    <div class="card question" id="questionCard">
      <div class="qtext" id="qText">–ù–∞–∂–º–∏ ¬´–ù–∞—á–∞—Ç—å¬ª, —á—Ç–æ–±—ã –≤—ã—è—Å–Ω–∏—Ç—å –ø—Ä–∞–≤–¥—É, –∫–æ—Ç–æ—Ä—É—é —Å—Ç—Ä–∞—à–Ω–æ –∑–Ω–∞—Ç—å.</div>
      <div class="options" id="options"></div>
      <div class="nav">
        <span class="muted" id="stepInfo">–í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –≠—Ç–æ –∫–∞–∫ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –±–µ–∑ –∫–æ—Ñ–µ.</span>
        <div style="display:flex; gap:8px">
          <button id="prevBtn" class="ghost" disabled>‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
          <button id="nextBtn" class="primary" disabled>–î–∞–ª—å—à–µ ‚û°Ô∏è</button>
        </div>
      </div>
      <div class="progressline"><span id="progress"></span></div>
    </div>

    <div class="card result hidden" id="resultCard">
      <div class="badge" id="badgeEmoji" aria-hidden="true">üßì</div>
      <div class="percent"><span id="finalPercent">0</span>% –°–ö–£–§</div>
      <div class="quip" id="finalLabel">–î–∏–∞–≥–Ω–æ–∑: ¬´–ñ–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω—ã–π –Ω–µ-—Å–∫uf¬ª. –í—Ä–∞—á–∏ –∞–ø–ª–æ–¥–∏—Ä—É—é—Ç —Å—Ç–æ—è.</div>
      <div class="quip" id="finalSubtype">–ü–æ–¥—Ç–∏–ø: ‚Äî</div>
      <div class="quip" id="finalQuote">–§—Ä–∞–∑–∞ –¥–Ω—è: ¬´‚Ä¶¬ª</div>
      <div class="share">
        <button id="copyBtn" class="primary">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        <button id="shareBtn" class="warn">üì£ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
        <button id="printBtn" class="primary">üñ®Ô∏è –°–∫–∞—á–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</button>
        <button id="againBtn" class="ghost">üîÅ –ü—Ä–æ–π—Ç–∏ –µ—â—ë —Ä–∞–∑</button>
      </div>
      <div class="footnote">–≠—Ç–æ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç. –ï—Å–ª–∏ —É–∑–Ω–∞–ª –≤ —Å–µ–±–µ —Å–∫—É—Ñ–∞ ‚Äî —ç—Ç–æ –Ω–µ –ø–æ–≤–æ–¥ –≥—Ä—É—Å—Ç–∏—Ç—å, —ç—Ç–æ –ø–æ–≤–æ–¥ –∑–∞–≤–∞—Ä–∏—Ç—å —á–∞–π ‚òïÔ∏è</div>
    </div>
  </div>

  <div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

<script>
/**
 * –°–∫—É—Ñ–æ–º–µ—Ä 3000 ‚Äî —Ñ–∏–∫—Å NaN + –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ—Å—Ç—ã + —Ä–∞–Ω–¥–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å–∫—É—Ñ–∞.
 * –ü–µ—Ä–µ—Å—á—ë—Ç –±–∞–ª–ª–æ–≤ –¥–µ–ª–∞–µ—Ç—Å—è ¬´—Å –Ω—É–ª—è¬ª –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ (recomputeTotals).
 */

const el = id => document.getElementById(id);

// ---------- –®—É—Ç–∫–∏ –∏ —Ç–µ–∫—Å—Ç—ã ----------
const quips = [
  [0, 10, "–ü–æ–∫–∞ —á—Ç–æ —Ç—ã –∫–∞–∫ —Å–≤–µ–∂–∏–π –æ–≥—É—Ä—á–∏–∫. –ù–æ –º—ã —É–∂–µ –∑–∞–Ω–µ—Å–ª–∏ –≤–∞–ª–∏–¥–æ–ª‚Ä¶"],
  [10, 25, "–ù–µ–±–æ–ª—å—à–æ–π –Ω–∞–ª—ë—Ç —Å–∫—É—Ñ–∞. –í–æ–∑–º–æ–∂–Ω–æ, —É —Ç–µ–±—è –¥–æ–º–∞ –µ—Å—Ç—å —Ö–∞–ª–∞—Ç, –Ω–æ —Ç—ã —ç—Ç–æ –æ—Ç—Ä–∏—Ü–∞–µ—à—å."],
  [25, 45, "–°—Ç–∞–±–∏–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤–æ—Ä—á—É–Ω—Å—Ç–≤–∞. –¢—ã —ç–∫–æ–Ω–æ–º–∏—à—å –Ω–µ –¥–µ–Ω—å–≥–∏ ‚Äî —Ç—ã —ç–∫–æ–Ω–æ–º–∏—à—å –¥—É—à–µ–≤–Ω—ã–µ —Å–∏–ª—ã."],
  [45, 65, "–û–≥–æ! –£–∂–µ –ø–∞—Ö–Ω–µ—Ç —Ç–∞–ø–æ—á–∫–∞–º–∏ –∏ –∫—Ä—É–∂–∫–æ–π ¬´–ª—É—á—à–µ–º—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É 2012¬ª."],
  [65, 85, "–°–∫—É—Ñ–æ—Ç–µ—Ä–∞–ø–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞: –ø—Ä–æ–≥—É–ª–∫–∞, –º–µ–º—ã –∏ –Ω–µ–º–Ω–æ–≥–æ ¬´—à–æ –≤—ã —Ç—É—Ç –≤—Å–µ —É—Å—Ç—Ä–æ–∏–ª–∏?¬ª."],
  [85, 101, "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É—Ä–æ–≤–µ–Ω—å! –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ ¬´–º–æ–ª–æ–¥—ë–∂—å¬ª —Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∑–¥—ã—Ö–∞–µ—à—å."]
];
function getQuip(p){ return quips.find(([a,b])=> p>=a && p<b)?.[2] ?? "–î–µ—Ä–∂–∏—à—å—Å—è –º–æ–ª–æ–¥—Ü–æ–º, —Å–∫—É—Ñ-–∏–≥—Ä–æ–∫!"; }
function randomItem(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

const subtypes = [
  {name:"–î–æ–º–∞—à–Ω–∏–π —Å–∫—É—Ñ", emoji:"üß¶", test:(p,a)=> p>=55 && a.halatrobe},
  {name:"–†–∞–±–æ—á–∏–π —Å–∫—É—Ñ", emoji:"üìé", test:(p,a)=> p>=50 && a.monday},
  {name:"–¢–µ—Ö–Ω–æ-—Å–∫—É—Ñ", emoji:"üíæ", test:(p,a)=> p>=45 && a.winUpdateFear},
  {name:"–≠–ª–∏—Ç–Ω—ã–π —Å–∫—É—Ñ", emoji:"üßê", test:(p,a)=> p>=70 && a.disdain},
  {name:"–ü–æ–ª–µ–≤–æ–π —Å–∫—É—Ñ", emoji:"ü™µ", test:(p,a)=> p>=40 && a.kettleMac}
];

const quotes = [
  "–°–µ–≥–æ–¥–Ω—è –∏–¥–µ–∞–ª—å–Ω—ã–π –¥–µ–Ω—å –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å –∏ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è.",
  "–†–∞–Ω—å—à–µ –∏ —á–∞–π –±—ã–ª –≥–æ—Ä—è—á–µ–µ‚Ä¶ —Ö–æ—Ç—è, –≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —á–∞–π–Ω–∏–∫ —Å–ª–æ–º–∞–ª—Å—è.",
  "–Ø –Ω–µ —Å—Ç–∞—Ä ‚Äî —è –∫–ª–∞—Å—Å–∏–∫ –≤ –∂–∞–Ω—Ä–µ ¬´—ç—Ö¬ª.",
  "–ù–∞–∂–∞–ª ¬´–æ—Ç–ª–æ–∂–∏—Ç—å¬ª ‚Äî —Å—ç–∫–æ–Ω–æ–º–∏–ª –Ω–µ—Ä–≤—ã. –ù–∞—É–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç (–º–Ω–æ–π).",
  "–ì–ª–∞–≤–Ω–æ–µ ‚Äî –ø–æ–∫–æ–π. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≥—Ä–æ–º–∫–æ."
];

// ---------- –†–∞–Ω–¥–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å–∫—É—Ñ–∞ ----------
/** –ú–∞–ª–µ–Ω—å–∫–∏–µ —Å–ª—É—á–∞–π–Ω—ã–µ –±–∞—Ñ—Ñ—ã/–¥–µ–±–∞—Ñ—Ñ—ã. –ò–∑–º–µ–Ω—è—é—Ç bonusPoints (¬±1..3 –æ—á–∫–∞). */
const SKUF_EVENTS = [
  {msg:"–í—Å–ø–æ–º–Ω–∏–ª –ø—Ä–æ —Å–∫–∏–¥–∫—É –Ω–∞ –Ω–æ—Å–∫–∏ ‚Äî —á—É–≤—Å—Ç–≤–æ –±–ª–∞–≥–æ—Ä–æ–¥–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏ –æ–∫—É—Ç–∞–ª–æ —Ç–µ–±—è.", delta:+2},
  {msg:"–ó–∞–ª–∏–ø –Ω–∞ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ —Ü–µ–Ω –≤ –ø–æ–¥—ä–µ–∑–¥–µ. –¢—ã –∫–∏–≤–∞–ª –æ—Å–æ–±–µ–Ω–Ω–æ –æ–ø—ã—Ç–Ω–æ.", delta:+3},
  {msg:"–†–µ–∑–∫–æ –∑–∞—Ö–æ—Ç–µ–ª–æ—Å—å –¥–æ–º–æ–π –∫ —Å–µ—Ä–∏–∞–ª—É. –£—Å—Ç–∞–ª –º–æ—Ä–∞–ª—å–Ω–æ, —Ö–æ—Ç—è –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–ª.", delta:+1},
  {msg:"–°–¥–µ–ª–∞–ª –≥–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö –≤–µ—Å–Ω—ã –∏‚Ä¶ —Ä–∞–∑–Ω—ã–ª—Å—è. –°–∞–º–æ–∫—Ä–∏—Ç–∏—á–Ω–æ.", delta:+1},
  {msg:"–†–µ—à–∏–ª –æ–±–Ω–æ–≤–∏—Ç—å Windows –∏ –ø–µ—Ä–µ–¥—É–º–∞–ª ‚Äî –º—É–¥—Ä–æ—Å—Ç—å –ø–æ–±–µ–¥–∏–ª–∞.", delta:+2},
  {msg:"–î—Ä—É–≥ –ø–æ–∑–≤–∞–ª –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É ‚Äî —Ç—ã —Å–æ–≥–ª–∞—Å–∏–ª—Å—è. –°–ª—É—á–∞–π–Ω–æ –º–∏–Ω—É—Å —Å–∫—É—Ñ.", delta:-2},
  {msg:"–ü—Ä–æ—à—ë–ª –º–∏–º–æ —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏ –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∫—É–ø–∏–ª ‚Äî —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∑–∞–∫–∞–ª—ë–Ω.", delta:-1},
  {msg:"–°–∫–∏–Ω—É–ª –º–µ–º –¥—Ä—É–∑—å—è–º —Ä–∞–Ω—å—à–µ, —á–µ–º –≤–∑–¥–æ—Ö–Ω—É–ª ‚Äî –ø—Ä–æ–≥—Ä–µ—Å—Å!", delta:-3}
];

function maybeTriggerRandomEvent(){
  // ~25% —à–∞–Ω—Å –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
  if (Math.random() < 0.25){
    const ev = randomItem(SKUF_EVENTS);
    state.bonusPoints += ev.delta;
    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—Å—Ç –Ω–∞ 12 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å
    toast(
      (ev.delta>0?"üßì ":"üåÄ ") + ev.msg + ` ${ev.delta>0?`(+${ev.delta} –æ—á–∫.)`:`(${ev.delta} –æ—á–∫.)`}`,
      12000
    );
    recomputeTotals();
  }
}

// ---------- –ë–∞–∑–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ (–≤–µ—Ç–≤–ª–µ–Ω–∏—è) ----------
const QUESTIONS = [
  {
    id:"intro",
    type:"choice",
    text:"–ì–æ—Ç–æ–≤ —É–∑–Ω–∞—Ç—å –ø—Ä–∞–≤–¥—É? –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é: —Å–∫—É—Ñ –≤–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∞—Å. –£ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö ‚Äî —Å –∫—Ä—É–∂–∫–æ–π.",
    options:[
      {label:"–ü–æ–µ—Ö–∞–ª–∏! üßì", points:4},
      {label:"–Ø –≤–æ–æ–±—â–µ-—Ç–æ –∑—É–º–µ—Ä! üòé", points:1, next:"youthCheck"}
    ]
  },
  {
    id:"kettleMac",
    type:"choice",
    text:"–ó–∞–ª–∏–≤–∞–µ—à—å –ª–∏ –º–∞–∫–∞—Ä–æ–Ω—ã –∫–µ—Ç—á—É–ø–æ–º?",
    flag:"kettleMac",
    options:[
      {label:"–í—Å–µ–≥–¥–∞. –Ø —ç—Å—Ç–µ—Ç.", points:8},
      {label:"–†–µ–¥–∫–æ. –ù–æ –∏–Ω–æ–≥–¥–∞‚Ä¶", points:4},
      {label:"–ù–∏–∫–æ–≥–¥–∞! –Ø —É–≤–∞–∂–∞—é –ø–∞—Å—Ç—É.", points:0}
    ]
  },
  {
    id:"halatrobe",
    type:"choice",
    text:"–ï—Å—Ç—å –ª–∏ —É —Ç–µ–±—è –¥–æ–º–∞—à–Ω–∏–π —Ö–∞–ª–∞—Ç/—Ç–∞–ø–æ—á–∫–∏?",
    flag:"halatrobe",
    options:[
      {label:"–ü–∞–∫–µ—Ç–∏–∫ —á–∞—è, —Å–µ—Ä–∏–∞–ª –∏ —è ‚Äî –∫–æ–º–ø–ª–µ–∫—Ç.", points:8},
      {label:"–ò–Ω–æ–≥–¥–∞ –Ω–æ—à—É, –µ—Å–ª–∏ —Ö–æ–ª–æ–¥–Ω–æ.", points:4},
      {label:"–ö–∞–∫–∏–µ —Ç–∞–ø–æ—á–∫–∏? –¢–æ–ª—å–∫–æ –∫—Ä–æ—Å—Å—ã!", points:0}
    ]
  },
  {
    id:"windows",
    type:"choice",
    text:"–ë–æ–∏—à—å—Å—è –æ–±–Ω–æ–≤–ª—è—Ç—å Windows? (–≤–¥—Ä—É–≥ –≤—Å—ë —Å–ª–æ–º–∞–µ—Ç—Å—è –∏ –ø—Ä–æ–ø–∞–¥—ë—Ç ¬´–°–∞–ø—ë—Ä¬ª)",
    flag:"winUpdateFear",
    options:[
      {label:"–ñ–¥—É –≥–æ–¥–∏–∫. –ü—É—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–æ—Ç–µ—Å—Ç—è—Ç.", points:8},
      {label:"–°—Ç–∞–≤–ª—é —á–µ—Ä–µ–∑ –ø–∞—Ä—É –Ω–µ–¥–µ–ª—å.", points:4},
      {label:"–°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è—é. –ñ–∏–≤—É –æ–ø–∞—Å–Ω–æ.", points:0}
    ]
  },
  {
    id:"rizz",
    type:"choice",
    text:"–¢—ã –ø–æ–Ω–∏–º–∞–µ—à—å, —á—Ç–æ —Ç–∞–∫–æ–µ ¬´rizz¬ª?",
    options:[
      {label:"–ö–æ–Ω–µ—á–Ω–æ, —ç—Ç–æ —Ö–∞—Ä–∏–∑–º–∞!", points:0, next:"flex"},
      {label:"–ü—Ä–∏—Ç–≤–æ—Ä—é—Å—å, —á—Ç–æ –ø–æ–Ω–∏–º–∞—é.", points:5},
      {label:"Rizz ‚Äî —ç—Ç–æ —á—Ç–æ, —É—Ç—é–≥?", points:9}
    ]
  },
  {
    id:"flex",
    type:"slider",
    text:"–ù–∞—Å–∫–æ–ª—å–∫–æ –ø–æ —à–∫–∞–ª–µ 0‚Äì100 —Ç–µ–±–µ –ª–µ–Ω—å –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –¥–æ–º–∞ –ø–æ—Å–ª–µ 20:00?",
    sliderMaxPoints:10
  },
  {
    id:"music",
    type:"choice",
    text:"–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—ç–ø–µ—Ä–æ–≤ —Å–ª—É—à–∞–µ—à—å?",
    options:[
      {label:"–î–∞. –Ø –≤ —Ç–µ–º–µ.", points:0},
      {label:"–¢–æ–ª—å–∫–æ —Å—Ç–∞—Ä–∏—á–∫–æ–≤.", points:5},
      {label:"–†—ç–ø ‚Äî —ç—Ç–æ –Ω–µ –º—É–∑—ã–∫–∞, —ç—Ö!", points:9}
    ]
  },
  {
    id:"monday",
    type:"choice",
    text:"–ß—É–≤—Å—Ç–≤—É–µ—à—å –ª–∏ –¥—É—Ö–æ–≤–Ω—É—é —Å–≤—è–∑—å —Å —Ñ—Ä–∞–∑–æ–π ¬´–∂–∏—Ç—å –±—ã –¥–æ –ø—è—Ç–Ω–∏—Ü—ã¬ª?",
    flag:"monday",
    options:[
      {label:"–≠—Ç–æ –º–æ–π –¥–µ–≤–∏–∑.", points:8},
      {label:"–ò–Ω–æ–≥–¥–∞ –¥–∞.", points:4},
      {label:"–Ø –ª—é–±–ª—é –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∏ (–¥–∞, —è —Å—Ç—Ä–∞–Ω–Ω—ã–π).", points:0}
    ]
  },
  {
    id:"youthCheck",
    type:"choice",
    text:"–•–æ—Ä–æ—à–æ, –∑—É–º–µ—Ä. –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç ¬´GYAT¬ª?",
    options:[
      {label:"–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π –Ø–¥—Ä–µ–Ω—ã–π‚Ä¶ –ª–∞–¥–Ω–æ, –Ω–µ –∑–Ω–∞—é.", points:7},
      {label:"–ü—Ä–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Å —ç—Ç–∏–∫–µ—Ç–æ–º‚Ä¶ —Ñ–æ—Ä–º—ã.", points:0},
      {label:"–≠—Ç–æ –Ω–æ–≤–∞—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞?", points:9}
    ]
  },
  {
    id:"disdain",
    type:"choice",
    text:"–ö–∞–∫ —á–∞—Å—Ç–æ —Ç—ã –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—à—å ¬´–≤–æ—Ç —Ä–∞–Ω—å—à–µ –±—ã–ª–æ –ª—É—á—à–µ¬ª?",
    flag:"disdain",
    options:[
      {label:"–≠—Ç–æ –º–æ—ë –∫–æ–º–±–æ —Å ¬´—Ç—Ä–∞–≤–∞ –∑–µ–ª–µ–Ω–µ–µ¬ª.", points:9},
      {label:"–ò–Ω–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —Ü–µ–Ω—ã –≤–∏–∂—É.", points:5},
      {label:"–Ø –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å. –ò –∑–∞ —Å–∫–∏–¥–∫–∏.", points:1}
    ]
  },
  {
    id:"teaMug",
    type:"choice",
    text:"–£ —Ç–µ–±—è –µ—Å—Ç—å –ª—é–±–∏–º–∞—è –ø–æ—Ç—ë—Ä—Ç–∞—è –∫—Ä—É–∂–∫–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è?",
    options:[
      {label:"–î–∞, –∏ –æ–Ω–∞ –ø–µ—Ä–µ–∂–∏–ª–∞ —Ç—Ä–∏ –ø–µ—Ä–µ–µ–∑–¥–∞.", points:9},
      {label:"–ï—Å—Ç—å, –Ω–æ —è –µ—ë –Ω–µ –ª—é–±(–ª)—é.", points:4},
      {label:"–ö—Ä—É–∂–∫–∏ –æ–±–Ω–æ–≤–ª—è—é —á–∞—â–µ —á–µ–º –ø–ª–∞–Ω—ã –Ω–∞ –∂–∏–∑–Ω—å.", points:0}
    ]
  },
  {
    id:"wifi",
    type:"slider",
    text:"–ù–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω—ã–π Wi-Fi? (0 ‚Äî ¬´–≤—Å—ë —Ä–∞–≤–Ω–æ¬ª, 100 ‚Äî ¬´–∫—Ç–æ –≤—ã–∫–ª—é—á–∏–ª –∏–Ω—Ç–µ—Ä–Ω–µ—Ç 220V?¬ª)",
    sliderMaxPoints:8
  },
  {
    id:"gym",
    type:"choice",
    text:"–°–ø–æ—Ä—Ç:",
    options:[
      {label:"–î–∏–≤–∞–Ω–Ω—ã–π —Ç—Ä–∏–∞—Ç–ª–æ–Ω: –¥–∏–≤–∞–Ω-—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫-–¥–∏–≤–∞–Ω.", points:9},
      {label:"–•–æ–∂—É –∏–Ω–æ–≥–¥–∞, –Ω–æ —Å—Ç—Ä–∞–¥–∞—é –ø—É–±–ª–∏—á–Ω–æ.", points:4},
      {label:"–ó–∞–ª ‚Äî –º–æ–π –¥–æ–º.", points:0}
    ]
  },
  {
    id:"finalPing",
    type:"choice",
    text:"–§–∏–Ω–∞–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å: –µ—Å–ª–∏ –¥—Ä—É–∑—å—è –∑–æ–≤—É—Ç –≥—É–ª—è—Ç—å, –∞ —Ç—ã —É–∂–µ –≤ —Ç–∞–ø–æ—á–∫–∞—Ö‚Ä¶",
    options:[
      {label:"–û—Ç–∫–∞–∑—ã–≤–∞—é—Å—å —Å –¥–æ—Å—Ç–æ–π–Ω–æ–π –≥—Ä—É—Å—Ç—å—é.", points:8},
      {label:"–ò–¥—É, –Ω–æ –≤–æ—Ä—á—É –¥–ª—è –±–∞–ª–∞–Ω—Å–∞.", points:5},
      {label:"–í—ã–±–µ–≥–∞—é. –¢–∞–ø–æ—á–∫–∏ ‚Äî —Å–æ –º–Ω–æ–π.", points:2}
    ]
  }
];

const ORDER = ["intro","kettleMac","halatrobe","windows","rizz","flex","music","monday","youthCheck","disdain","teaMug","wifi","gym","finalPing"];

const state = {
  started:false,
  anti:false,
  idx:0,
  pathIds:[],
  answers:{},      // id -> {type, value}
  flags:{},        // –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏
  totalPoints:0,
  totalMax:0,
  bonusPoints:0    // —Ä–∞–Ω–¥–æ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è —Å–∫—É—Ñ–∞ (¬±)
};

function reset(){
  state.started=false; state.anti=false; state.idx=0;
  state.pathIds=[...ORDER];
  state.answers={}; state.flags={};
  state.totalPoints=0; state.totalMax=0; state.bonusPoints=0;
  el("options").innerHTML="";
  el("qText").textContent = "–ù–∞–∂–º–∏ ¬´–ù–∞—á–∞—Ç—å¬ª, —á—Ç–æ–±—ã –≤—ã—è—Å–Ω–∏—Ç—å –ø—Ä–∞–≤–¥—É, –∫–æ—Ç–æ—Ä—É—é —Å—Ç—Ä–∞—à–Ω–æ –∑–Ω–∞—Ç—å.";
  el("stepInfo").textContent = "–í–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç. –≠—Ç–æ –∫–∞–∫ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –±–µ–∑ –∫–æ—Ñ–µ.";
  el("progress").style.width = "0%";
  setPercent(0);
  el("resultCard").classList.add("hidden");
  el("questionCard").classList.remove("hidden");
  el("nextBtn").disabled = true; el("prevBtn").disabled = true;
  shakeQuip("–ü–æ–∫–∞ —á—Ç–æ —Ç—ã –∫–∞–∫ —Å–≤–µ–∂–∏–π –æ–≥—É—Ä—á–∏–∫. –ù–æ –º—ã —É–∂–µ –∑–∞–Ω–µ—Å–ª–∏ –≤–∞–ª–∏–¥–æ–ª‚Ä¶");
}

function shakeQuip(text){ el("quip").textContent = text; }
function findQ(id){ return QUESTIONS.find(q=>q.id===id); }

function start(){
  state.started = true;
  state.idx = 0;
  renderCurrent();
}

function setPercent(p){
  const n = Number.isFinite(p) ? Math.max(0, Math.min(100, Math.round(p))) : 0;
  el("percentVal").textContent = n;
  el("meterBar").style.width = n + "%";
  shakeQuip(getQuip(n));
}

function recomputeTotals(){
  let totalPoints = 0;
  let totalMax = 0;

  for (const id of state.pathIds){
    const ans = state.answers[id];
    if (!ans) continue;
    const q = findQ(id);
    if (!q) continue;

    if (q.type === "choice"){
      const max = Math.max(0, ...q.options.map(o=>Number.isFinite(o.points)?o.points:0));
      const chosen = q.options[ans.value];
      const base = Number.isFinite(chosen?.points) ? chosen.points : 0;
      const adjusted = adjustForMode(base);
      totalMax += max;
      totalPoints += adjusted;
    } else if (q.type === "slider"){
      const max = Number.isFinite(q.sliderMaxPoints) ? q.sliderMaxPoints : 10;
      const val = Math.max(0, Math.min(100, Number(ans.value) || 0));
      const base = Math.round((val/100) * max);
      const adjusted = adjustForMode(base);
      totalMax += max;
      totalPoints += adjusted;
    }
  }

  state.totalMax = totalMax;
  state.totalPoints = totalPoints;

  const percent = (state.totalMax>0)
    ? ((state.totalPoints + state.bonusPoints) / state.totalMax) * 100
    : 0;
  setPercent(percent);
}

function renderCurrent(){
  const id = state.pathIds[state.idx];
  const q = findQ(id);
  if (!q) return;
  el("qText").textContent = q.text;
  el("options").innerHTML = "";

  if (q.type === "choice"){
    q.options.forEach((opt, i)=>{
      const wrap = document.createElement("label");
      wrap.className = "opt";
      const input = document.createElement("input");
      input.type = "radio"; input.name = "opt"; input.value = i;
      if (state.answers[id]?.value === i) input.checked = true;
      const span = document.createElement("span"); span.textContent = opt.label;
      wrap.appendChild(input); wrap.appendChild(span);
      wrap.addEventListener("click", ()=> selectChoice(id, i));
      el("options").appendChild(wrap);
    });
  } else if (q.type === "slider"){
    const wrap = document.createElement("div");
    wrap.className = "opt"; wrap.style.display="grid"; wrap.style.gap="8px";
    const val = state.answers[id]?.value ?? 0;
    wrap.innerHTML = `
      <div class="muted">–ü–µ—Ä–µ—Ç–∞—â–∏ –ø–æ–ª–∑—É–Ω–æ–∫. –ü–æ–¥—Å—á—ë—Ç —Å–∫—É—Ñ–∞ –∏–¥—ë—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.</div>
      <input id="slider" type="range" min="0" max="100" step="1" value="${val}">
      <div><b>–ó–Ω–∞—á–µ–Ω–∏–µ:</b> <span id="sliderVal">${val}</span> / 100</div>
    `;
    el("options").appendChild(wrap);
    const slider = el("slider");
    const sliderVal = el("sliderVal");
    slider.addEventListener("input", ()=>{
      sliderVal.textContent = slider.value;
      selectSlider(id, Number(slider.value), {preview:true});
    });
    slider.addEventListener("change", ()=>{
      selectSlider(id, Number(slider.value), {preview:false});
    });
  }

  // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
  el("prevBtn").disabled = state.idx===0;
  el("nextBtn").disabled = !state.answers[id];
  el("stepInfo").textContent = `–í–æ–ø—Ä–æ—Å ${state.idx+1} –∏–∑ ${state.pathIds.length}`;
  el("progress").style.width = ((state.idx)/(Math.max(1,state.pathIds.length-1)))*100 + "%";
}

function selectChoice(id, optIndex){
  const q = findQ(id);
  const opt = q.options[optIndex];

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç
  state.answers[id] = {type:"choice", value: optIndex};

  // –§–ª–∞–≥–∏ –¥–ª—è –ø–æ–¥—Ç–∏–ø–æ–≤
  if (q.flag){ state.flags[q.flag] = true; }

  // –í–µ—Ç–≤–ª–µ–Ω–∏–µ
  if (opt.next){
    const nextId = opt.next;
    const nextTail = [nextId, ...ORDER.slice(ORDER.indexOf(nextId)+1)];
    state.pathIds = [...state.pathIds.slice(0, state.idx+1), ...nextTail];
  } else {
    const currentIndexInOrder = ORDER.indexOf(id);
    const tail = ORDER.slice(currentIndexInOrder+1);
    const merged = [ ...state.pathIds.slice(0, state.idx+1) ];
    tail.forEach(qid => { if (!merged.includes(qid)) merged.push(qid); });
    state.pathIds = merged;
  }

  el("nextBtn").disabled = false;

  // –ü–µ—Ä–µ—Å—á—ë—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤
  recomputeTotals();

  // –°–ª—É—á–∞–π–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–∫—É—Ñ–∞ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—Å—Ç –Ω–∞ 12 —Å–µ–∫)
  maybeTriggerRandomEvent();
}

function selectSlider(id, val, {preview}){
  state.answers[id] = {type:"slider", value: Math.max(0, Math.min(100, Number(val)||0))};
  recomputeTotals();
  if (!preview) el("nextBtn").disabled = false;
}

function adjustForMode(points){
  if (!state.anti) return points;
  const baseMax = 10;
  const p = Number.isFinite(points) ? points : 0;
  const inv = baseMax - Math.max(0, Math.min(baseMax, p));
  return inv;
}

function goNext(){
  if (!state.started){ start(); return; }
  if (state.idx >= state.pathIds.length-1){ finish(); return; }
  state.idx++; renderCurrent();
}
function goPrev(){ if (state.idx===0) return; state.idx--; renderCurrent(); }

function finish(){
  const percent = Number(el("percentVal").textContent) || 0;
  el("finalPercent").textContent = percent;

  const emoji = percent<20 ? "üßí" : percent<40 ? "üßë" : percent<60 ? "üßî" : percent<80 ? "üßì" : "ü¶ñ";
  el("badgeEmoji").textContent = emoji;

  const facts = {
    halatrobe: !!state.flags.halatrobe,
    monday: !!state.flags.monday,
    winUpdateFear: !!state.flags.winUpdateFear,
    disdain: !!state.flags.disdain,
    kettleMac: !!state.flags.kettleMac
  };
  const st = subtypes.find(s=> s.test(percent, facts));
  const subtypeText = st ? `${st.emoji} ${st.name}` : "üåÄ –ú—É–ª—å—Ç–∏-—Å–∫uf: –ø–æ–Ω–µ–º–Ω–æ–≥—É –æ—Ç–æ–≤—Å—é–¥—É";
  el("finalSubtype").textContent = `–ü–æ–¥—Ç–∏–ø: ${subtypeText}`;

  const label =
    percent<15 ? "–î–∏–∞–≥–Ω–æ–∑: ¬´–ñ–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω—ã–π –∞–Ω—Ç–∏-—Å–∫—É—Ñ¬ª. –¢—ã –æ–ø–∞—Å–Ω–æ –ø–æ–∑–∏—Ç–∏–≤–µ–Ω."
  : percent<35 ? "–ù–µ–±–æ–ª—å—à–∞—è —Å–∫—É—Ñ–Ω–æ—Å—Ç—å. –ò–Ω–æ–≥–¥–∞ –≤–æ—Ä—á–∏—à—å –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏."
  : percent<55 ? "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—É—Ñ. –£–º–µ–µ—à—å –∏ –≤–∑–¥–æ—Ö–Ω—É—Ç—å, –∏ –ø–æ–≤–µ—Å–µ–ª–∏—Ç—å—Å—è."
  : percent<75 ? "–£–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–∫—É—Ñ. –¢–∞–ø–æ—á–∫–∏ ‚Äî —á–∞—Å—Ç—å –æ–±—Ä–∞–∑–∞, –∞ –Ω–µ –æ–±—É–≤—å."
  : "–¢–æ—Ä–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ: ¬´–≠—Ç–∞–ª–æ–Ω–Ω—ã–π —Å–∫—É—Ñ¬ª. –ì–æ—Ä–¥–∏—Å—å –∏ –∂–∞–ª—É–π—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.";
  el("finalLabel").textContent = label;

  el("finalQuote").textContent = `–§—Ä–∞–∑–∞ –¥–Ω—è: ¬´${randomItem(quotes)}¬ª`;

  el("questionCard").classList.add("hidden");
  el("resultCard").classList.remove("hidden");
}

function toast(msg="–ì–æ—Ç–æ–≤–æ!", duration=12000){
  const t = el("toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(t._hideTimer);
  t._hideTimer = setTimeout(()=> t.classList.remove("show"), duration);
}

// ---------- –°–æ–±—ã—Ç–∏—è UI ----------
el("startBtn").addEventListener("click", ()=>{
  if (!state.started) start(); else goNext();
});
el("nextBtn").addEventListener("click", goNext);
el("prevBtn").addEventListener("click", goPrev);

el("restartBtn").addEventListener("click", reset);

el("againBtn").addEventListener("click", ()=>{
  reset(); start();
});

el("toggleMode").addEventListener("click", ()=>{
  state.anti = !state.anti;
  el("toggleMode").textContent = state.anti ? "üß™ Anti-Skuf" : "üßì –û–±—ã—á–Ω—ã–π";
  el("modeHint").textContent = `–†–µ–∂–∏–º: ${state.anti ? "Anti-Skuf (–ø—Ä–æ–±—É–π –±—ã—Ç—å ¬´–º–µ–Ω–µ–µ —Å–∫—É—Ñ–æ–º¬ª)" : "–û–±—ã—á–Ω—ã–π"}`;
  recomputeTotals(); // –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–¥ –Ω–æ–≤—ã–π —Ä–µ–∂–∏–º
});

el("copyBtn").addEventListener("click", ()=>{
  const p = el("finalPercent").textContent;
  const subtype = el("finalSubtype").textContent.replace("–ü–æ–¥—Ç–∏–ø: ","");
  const label = el("finalLabel").textContent;
  const quote = el("finalQuote").textContent.replace("–§—Ä–∞–∑–∞ –¥–Ω—è: ","");
  const mode = state.anti ? "Anti-Skuf" : "–û–±—ã—á–Ω—ã–π";
  const text = `–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ ¬´–°–∫—É—Ñ–æ–º–µ—Ä 3000¬ª: ${p}% —Å–∫—É—Ñ (${subtype}). ${label} ${quote} ‚Äî –†–µ–∂–∏–º: ${mode}`;
  navigator.clipboard.writeText(text).then(()=> toast("–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!", 2500));
});

el("shareBtn").addEventListener("click", async ()=>{
  const p = el("finalPercent").textContent;
  const subtype = el("finalSubtype").textContent.replace("–ü–æ–¥—Ç–∏–ø: ","");
  const label = el("finalLabel").textContent;
  const quote = el("finalQuote").textContent.replace("–§—Ä–∞–∑–∞ –¥–Ω—è: ","");
  const mode = state.anti ? "Anti-Skuf" : "–û–±—ã—á–Ω—ã–π";
  const text = `–ú–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ ¬´–°–∫—É—Ñ–æ–º–µ—Ä 3000¬ª: ${p}% —Å–∫—É—Ñ (${subtype}). ${label} ${quote} ‚Äî –†–µ–∂–∏–º: ${mode}`;
  if (navigator.share){
    try{ await navigator.share({title:"–°–∫—É—Ñ–æ–º–µ—Ä 3000", text}); }
    catch{ toast("–ù–µ –≤—ã—à–ª–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è‚Ä¶ –Ω–æ –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –≥–æ—Ä–¥–∏–º—Å—è —Ç–æ–±–æ–π.", 3000); }
  } else {
    navigator.clipboard.writeText(text);
    toast("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ, –∑–∞—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª–∏ —Ç–µ–∫—Å—Ç!", 3000);
  }
});

el("printBtn").addEventListener("click", ()=>{
  window.print();
});

// –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
document.addEventListener("keydown", (e)=>{
  if (e.key === "ArrowRight") { if (!el("nextBtn").disabled) goNext(); }
  if (e.key === "ArrowLeft")  { if (!el("prevBtn").disabled) goPrev(); }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
reset();
</script>
</body>
</html>
